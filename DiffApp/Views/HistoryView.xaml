<UserControl x:Class="DiffApp.Views.HistoryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:DiffApp.Views"
             xmlns:viewModels="clr-namespace:DiffApp.ViewModels"
             xmlns:fonts="clr-namespace:Fonts"
             xmlns:converters="clr-namespace:DiffApp.Converters"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800"
             Background="{StaticResource BrushBackground}"
             UseLayoutRounding="True"
             SnapsToDevicePixels="True">

	<UserControl.Resources>
		<converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
		<SolidColorBrush x:Key="BrushLightBlueBorder" Color="#D0E3F0"/>

		<Style x:Key="DeleteIconButtonStyle" TargetType="Button" BasedOn="{StaticResource IconButtonStyle}">
			<Style.Triggers>
				<Trigger Property="IsMouseOver" Value="True">
					<Setter Property="Foreground" Value="{StaticResource DangerBrush}"/>
				</Trigger>
			</Style.Triggers>
		</Style>
	</UserControl.Resources>

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<Border Grid.Row="0"
                Background="{StaticResource BrushSurface}"
                BorderBrush="{StaticResource BrushBorder}"
                BorderThickness="0,0,0,1"
                Padding="20,15">
			<Grid>
				<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
					<TextBlock Text="{x:Static fonts:MaterialIcons.history}" Style="{StaticResource IconStyle}" FontSize="24" Margin="0,0,10,0" Foreground="{StaticResource GrayTextBrush}"/>
					<TextBlock Text="History" FontSize="20" FontWeight="Bold" Foreground="{StaticResource BrushPrimary}"/>
				</StackPanel>

				<Button HorizontalAlignment="Right"
                        Style="{StaticResource DangerButton}"
                        Command="{Binding DeleteAllCommand}"
                        Visibility="{Binding HasItems, Converter={StaticResource BoolToVisibilityConverter}}"
                        ToolTip="Clear all history">
					<StackPanel Orientation="Horizontal">
						<TextBlock Text="{x:Static fonts:MaterialIcons.delete}" Style="{StaticResource IconStyle}" FontSize="18" Foreground="White" Margin="0,0,5,0"/>
						<TextBlock Text="Delete All" Foreground="White" FontWeight="SemiBold"/>
					</StackPanel>
				</Button>
			</Grid>
		</Border>

		<Grid Grid.Row="1" Panel.ZIndex="1">
			<Grid.Style>
				<Style TargetType="Grid">
					<Setter Property="Visibility" Value="Collapsed"/>
					<Style.Triggers>
						<DataTrigger Binding="{Binding HistoryItems.Count}" Value="0">
							<Setter Property="Visibility" Value="Visible"/>
						</DataTrigger>
					</Style.Triggers>
				</Style>
			</Grid.Style>

			<StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
				<TextBlock Text="{x:Static fonts:MaterialIcons.history_toggle_off}"
                           Style="{StaticResource IconStyle}"
                           FontSize="64"
                           Foreground="{StaticResource BrushBorder}"
                           Margin="0,0,0,20"/>
				<TextBlock Text="No history yet"
                           FontSize="18"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource GrayTextBrush}"
                           HorizontalAlignment="Center"/>
				<TextBlock Text="Comparisons will appear here automatically."
                           FontSize="14"
                           Foreground="{StaticResource GrayTextBrush}"
                           HorizontalAlignment="Center"
                           Margin="0,5,0,0"/>
			</StackPanel>
		</Grid>

		<ListView Grid.Row="1"
                  ItemsSource="{Binding HistoryItems}"
                  HorizontalContentAlignment="Stretch"
                  ScrollViewer.CanContentScroll="True"
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                  BorderThickness="0"
                  Padding="10">
			<ListView.ItemContainerStyle>
				<Style TargetType="ListViewItem">
					<Setter Property="HorizontalContentAlignment" Value="Stretch"/>
					<Setter Property="Margin" Value="0,0,0,8"/>
					<Setter Property="Background" Value="Transparent"/>
					<Setter Property="FocusVisualStyle" Value="{x:Null}"/>
					<Setter Property="Cursor" Value="Hand"/>
					<Setter Property="Template">
						<Setter.Value>
							<ControlTemplate TargetType="ListViewItem">
								<Border x:Name="CardBorder"
                                        Background="White"
                                        BorderBrush="{StaticResource BrushLightBlueBorder}"
                                        BorderThickness="1"
                                        Margin="1"
                                        CornerRadius="6"
                                        Padding="0">

									<Border.InputBindings>
										<MouseBinding MouseAction="LeftClick"
                                                      Command="{Binding DataContext.RestoreItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                      CommandParameter="{Binding}"/>
									</Border.InputBindings>

									<Grid>
										<ContentPresenter />

										<Grid IsHitTestVisible="True" HorizontalAlignment="Right" VerticalAlignment="Top">
											<Button Style="{StaticResource DeleteIconButtonStyle}"
                                                    Padding="6"
                                                    Margin="0,5,5,0"
                                                    Cursor="Hand"
                                                    ToolTip="Delete this item"
                                                    Command="{Binding DataContext.DeleteItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
												<TextBlock Text="{x:Static fonts:MaterialIcons.delete}"
                                                           Style="{StaticResource IconStyle}"
                                                           FontSize="20"/>
											</Button>
										</Grid>
									</Grid>

									<Border.Effect>
										<DropShadowEffect BlurRadius="5" ShadowDepth="1" Direction="270" Color="#000000" Opacity="0.05"/>
									</Border.Effect>
								</Border>
								<ControlTemplate.Triggers>
									<Trigger Property="IsMouseOver" Value="True">
										<Setter TargetName="CardBorder" Property="BorderBrush" Value="{StaticResource BrushAccent}"/>
										<Setter TargetName="CardBorder" Property="Background" Value="White"/>
										<Setter TargetName="CardBorder" Property="BorderThickness" Value="2"/>
										<Setter TargetName="CardBorder" Property="Margin" Value="0"/>
									</Trigger>

									<Trigger Property="IsSelected" Value="True">
										<Setter TargetName="CardBorder" Property="BorderBrush" Value="{StaticResource BrushAccent}"/>
										<Setter TargetName="CardBorder" Property="Background" Value="White"/>
									</Trigger>
								</ControlTemplate.Triggers>
							</ControlTemplate>
						</Setter.Value>
					</Setter>
				</Style>
			</ListView.ItemContainerStyle>

			<ListView.ItemTemplate>
				<DataTemplate DataType="{x:Type viewModels:HistoryItemViewModel}">
					<Grid Margin="15,12">
						<Grid.RowDefinitions>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
						</Grid.RowDefinitions>

						<TextBlock Grid.Row="0"
                                   Text="{Binding RelativeTime}"
                                   FontSize="11"
                                   Foreground="{StaticResource BrushAccent}"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>

						<Grid Grid.Row="1">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="30"/>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="40"/>
							</Grid.ColumnDefinitions>

							<Border Grid.Column="0"
                                    Background="{StaticResource BrushSurface}"
                                    CornerRadius="4"
                                    Padding="8,6">
								<TextBlock Text="{Binding DisplayOriginal}"
                                           FontFamily="{StaticResource CodeFont}"
                                           FontSize="12"
                                           Foreground="{StaticResource GrayTextBrush}"
                                           TextTrimming="CharacterEllipsis"/>
							</Border>

							<TextBlock Grid.Column="1"
                                       Text="{x:Static fonts:MaterialIcons.arrow_forward}"
                                       Style="{StaticResource IconStyle}"
                                       FontSize="16"
                                       Foreground="{StaticResource GrayTextBrush}"/>

							<Border Grid.Column="2"
                                    Background="{StaticResource BrushSurface}"
                                    CornerRadius="4"
                                    Padding="8,6">
								<TextBlock Text="{Binding DisplayModified}"
                                           FontFamily="{StaticResource CodeFont}"
                                           FontSize="12"
                                           Foreground="{StaticResource TextBrush}"
                                           FontWeight="SemiBold"
                                           TextTrimming="CharacterEllipsis"/>
							</Border>
						</Grid>
					</Grid>
				</DataTemplate>
			</ListView.ItemTemplate>
		</ListView>
	</Grid>
</UserControl>